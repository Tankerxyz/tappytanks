!function(c){function t(t){for(var e,n,i=t[0],o=t[1],r=t[2],a=0,s=[];a<i.length;a++)n=i[a],u[n]&&s.push(u[n][0]),u[n]=0;for(e in o)Object.prototype.hasOwnProperty.call(o,e)&&(c[e]=o[e]);for(d&&d(t);s.length;)s.shift()();return h.push.apply(h,r||[]),l()}function l(){for(var t,e=0;e<h.length;e++){for(var n=h[e],i=!0,o=1;o<n.length;o++){var r=n[o];0!==u[r]&&(i=!1)}i&&(h.splice(e--,1),t=a(a.s=n[0]))}return t}var n={},u={app:0},h=[];function a(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return c[t].call(e.exports,e,e.exports,a),e.l=!0,e.exports}a.m=c,a.c=n,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var e=window.webpackJsonp=window.webpackJsonp||[],i=e.push.bind(e);e.push=t,e=e.slice();for(var o=0;o<e.length;o++)t(e[o]);var d=i;h.push([28,"vendor"]),l()}({15:function(t,e,n){"use strict";var i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=i(n(0)),a=o(n(40)),s=o(n(41)),c=function(){function t(t,e){if(this._id=t.id,this._scene=e,this.createModel(t.position,t.rotation),this.stat=t.stat,t.animatable&&(this.animationCtrl=new a.default(6,this._model,e,this.id)),t.withGui){var n="Player: ("+this._id+")\n      hp: "+this.stat.hp+"/"+this.stat.maxHp;this.gui=new s.default({text:n,model:this.model})}}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"model",{get:function(){return this._model},enumerable:!0,configurable:!0}),t.prototype.createModel=function(t,e){this._model=r.MeshBuilder.CreateCylinder("playerModel"+this.id,{diameterTop:0,height:1,tessellation:96},this._scene),this._model.position=t,this._model.rotation=e},t.prototype.setPosition=function(t){this.animationCtrl?this.animationCtrl.startPositionAnimation(t):this._model.position=t},t.prototype.setRotation=function(t){this.animationCtrl?this.animationCtrl.startRotationAnimation(t):this._model.rotation=t},t.prototype.dispose=function(){this._model.dispose(),this.gui.dispose()},t}();e.default=c},28:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),n(29);var r=i(n(30)),a=i(n(14));window.addEventListener("DOMContentLoaded",function(){new r.default("#renderCanvas");var e=document.querySelector("#renderCanvas"),t=document.querySelector(".key.left"),n=document.querySelector(".key.right"),i=document.querySelector(".key.up"),o=document.querySelector(".key.down");t.addEventListener("click",function(t){e.dispatchEvent(new Event("focus")),e.dispatchEvent(new KeyboardEvent("keydown",{keyCode:a.default.codes.left}))}),n.addEventListener("click",function(t){e.dispatchEvent(new Event("focus")),e.dispatchEvent(new KeyboardEvent("keydown",{keyCode:a.default.codes.right}))}),i.addEventListener("click",function(t){e.dispatchEvent(new Event("focus")),e.dispatchEvent(new KeyboardEvent("keydown",{keyCode:a.default.codes.up}))}),o.addEventListener("click",function(t){e.dispatchEvent(new Event("focus")),e.dispatchEvent(new KeyboardEvent("keydown",{keyCode:a.default.codes.down}))})})},29:function(t,e,n){},30:function(t,u,h){"use strict";(function(e){var t=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(u,"__esModule",{value:!0});var i=t(h(0)),o=n(h(34)),r=n(h(35)),a=n(h(15)),s=n(h(43)),c=n(h(44)),l=function(){function t(t){var e=this;this.onField=function(t){e.playersCtrl.removeAll(),e.createField({width:t.width,height:t.height,debug:t.debug,walls:t.walls,players:e.playersCtrl.getPlayers()}),t.players&&t.players.forEach(function(t){return e.playersCtrl.addPlayer(t)})},this.onCreatePlayerSuccess=function(t){console.log("create-player-success: ",t),e._mainPlayer.id=t.id,e._mainPlayer.setPosition(t.position),e._mainPlayer.setRotation(t.rotation),e._camera.dispose(),e.createMainCamera(e._mainPlayer.model),e.createMoveController()},this._canvas=document.querySelector(t),this._engine=new i.Engine(this._canvas,!0,{antialias:!0},!0),this.init()}return t.prototype.init=function(){this.createScene(),this.doRender()},t.prototype.createScene=function(){this._scene=new i.Scene(this._engine),this._scene.actionManager=new i.ActionManager(this._scene),this._scene.debugLayer.show(),this.createMainLight(),this.createMainPlayer(),this.createMainCamera(this._mainPlayer.model),this.playersCtrl=new s.default([],this._scene),this.createConnection()},t.prototype.createConnection=function(){var t="ws://tappytanks-api.herokuapp.com"+(e.env.API_PORT?":"+e.env.API_PORT:"");console.log(t),this.net=new c.default({url:t,playersCtrl:this.playersCtrl,events:{onField:this.onField,onCreatePlayerSuccess:this.onCreatePlayerSuccess}})},t.prototype.doRender=function(){var t=this;this._engine.runRenderLoop(function(){t._scene.render()}),window.addEventListener("resize",function(){t._engine.resize()})},t.prototype.createField=function(t){this._field&&(this._field.dispose(),delete this._field),this._field=new o.default(t,this._scene)},t.prototype.createMainCamera=function(t){this._camera=new i.FollowCamera("freeCamera-1",new i.Vector3(t.position.x,t.position.y+2,t.position.z),this._scene,t),this._camera.rotationOffset=180*t.rotation.z/Math.PI,this._camera.cameraAcceleration=.04,this._camera.radius=6,this._camera.heightOffset=3,window.camera=this._camera},t.prototype.createMainLight=function(){this._light=new i.HemisphericLight("hsLight-1",new i.Vector3(-50,60,-50),this._scene)},t.prototype.createMainPlayer=function(){this._mainPlayer=new a.default({position:new i.Vector3(0,1,0),rotation:new i.Vector3(-Math.PI/2,0,0),stat:{hp:100,maxHp:100},id:"temp-id"},this._scene)},t.prototype.createMoveController=function(){this._moveController&&(this._moveController.dispose(),this._moveController=null,delete this._moveController),this._moveController=new r.default(this._scene,this._field,this._mainPlayer,this._camera,this.net)},t}();u.default=l}).call(this,h(3))},34:function(t,e,n){"use strict";var i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var r=i(n(0)),o=function(){function t(t,e){this._walls=[],this._players=[],this._width=t.width,this._height=t.height,this._scene=e,this.generateModel(e),t.debug&&this.createDebugLayerLines(2),t.walls&&this.generateFieldWalls(t.walls),t.players&&(this._players=t.players)}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.generateFieldWalls=function(t){var i=this;t.forEach(function(t,e){var n=r.MeshBuilder.CreateBox("fieldWall"+e,{size:t.size},i._scene);n.position=t.position,i._walls.push(n)})},t.prototype.generateModel=function(t){var e=new r.StandardMaterial("material",t);e.diffuseColor=new r.Color3(.08,.21,.47),this._model=r.MeshBuilder.CreateGround("ground",{width:this._width,height:this._height,subdivisions:this._width/2},t),this._model.material=e},t.prototype.createDebugLayerLines=function(t){for(var e=this.width/2,n=this.height/2,i=-e;i<=e;i+=t)r.MeshBuilder.CreateLines("line_z"+(i||"("+i+")"),{points:[new r.Vector3(i,.01,e),new r.Vector3(i,.01,-e)]});for(var o=-n;o<=n;o+=t)r.MeshBuilder.CreateLines("line_x"+(o||"("+o+")"),{points:[new r.Vector3(n,.01,o),new r.Vector3(-n,.01,o)]})},t.prototype.getWallsByPosition=function(e){return this._walls.filter(function(t){if(e.x===t.position.x&&e.z===t.position.z)return t})},t.prototype.getPlayerModelByPosition=function(n){return this._players.filter(function(t){var e=t.model;if(n.x===e.position.x&&n.z===e.position.z)return e})},t.prototype.dispose=function(){this._walls.map(function(t){return t.dispose()})},t}();e.default=o},35:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=i(n(36)),o=function(){function t(t,e,n,i,o){var r=this;this.collisionNormalizer=function(t,e){var n=r._field.width/2;if(t.x>n||t.x<-n)return t.x=e.x,t;var i=r._field.height/2;return t.z>i||t.z<-i?t.z=e.z:r._field.getWallsByPosition(t).length?(t.z=e.z,t.x=e.x):r._field.getPlayerModelByPosition(t).length&&(t.z=e.z,t.x=e.x),t},this._movableObject=n.model,this._field=e,this._controls=new a.default(t,this._movableObject,i,this.collisionNormalizer,o)}return t.prototype.dispose=function(){this._controls.dispose()},t}();e.default=o},36:function(t,e,n){"use strict";var i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var d=i(n(0)),a=o(n(14)),r=o(n(37)),f=n(39),s=function(){function t(t,c,r,l,u){var h=this;this.actions=[],this.animations=[],this.actionStarted=!1,this.maxFrame=6,this.canRunAction=function(){return!1===h.actionStarted},this.onActionStart=function(){h.actionStarted=!0},this.onActionEnd=function(){h.actionStarted=!1},this._scene=t,this.movableObject=c,this.addAnimatableAction(this.createAnimatableAction(a.default.codes.left,"animation_left","rotation",function(){var t=c.rotation,e=t.x,n=t.y,i=t.z,o=new d.Vector3(e,n,i-Math.PI/2);return r.rotationOffset=180*o.z/Math.PI,u.changeRotation(o),[{frame:0,value:new d.Vector3(e,n,i)},{frame:h.maxFrame,value:o}]},c),c),this.addAnimatableAction(this.createAnimatableAction(a.default.codes.right,"animation_right","rotation",function(){var t=c.rotation,e=t.x,n=t.y,i=t.z,o=new d.Vector3(e,n,i+Math.PI/2);return r.rotationOffset=180*o.z/Math.PI,u.changeRotation(o),[{frame:0,value:new d.Vector3(e,n,i)},{frame:h.maxFrame,value:o}]},c),c),this.addAnimatableAction(this.createAnimatableAction(a.default.codes.up,"animation_up","position",function(){var t=c.position,e=t.x,n=t.y,i=t.z,o=f.normalizeNewPositionFromRotationZ(c.rotation.z),r=o.newX,a=o.newZ,s=l(new d.Vector3(Math.round(e-r),n,Math.round(i-a)),c.position);return u.changePosition(s),[{frame:0,value:new d.Vector3(e,n,i)},{frame:h.maxFrame,value:s}]},c),c),this.addAnimatableAction(this.createAnimatableAction(a.default.codes.down,"animation_down","position",function(){var t=c.position,e=t.x,n=t.y,i=t.z,o=f.normalizeNewPositionFromRotationZ(c.rotation.z),r=o.newX,a=o.newZ,s=l(new d.Vector3(Math.round(e+r),n,Math.round(i+a)),c.position);return u.changePosition(s),[{frame:0,value:new d.Vector3(e,n,i)},{frame:h.maxFrame,value:s}]},c),c)}return t.prototype.beginAnimation=function(n){var i=this;return function(t){var e;(e=i._scene).beginDirectAnimation.apply(e,[n].concat(t))}},t.prototype.createAnimatableAction=function(t,e,n,i,o){return new r.default({trigger:d.ActionManager.OnKeyDownTrigger,parameter:t},new d.Animation(e,n,60,d.Animation.ANIMATIONTYPE_VECTOR3),i,this.beginAnimation(o),this.maxFrame,this.canRunAction,this.onActionStart,this.onActionEnd)},t.prototype.addAnimatableAction=function(t,e){this.actions.push(t),this._scene.actionManager.registerAction(t.action),this.attachAnimation(e)(t.animation)},t.prototype.attachAnimation=function(e){var n=this;return function(t){n.animations.push(t),e.animations.push(t)}},t.prototype.dispose=function(){var e=this;this.actions.forEach(function(t){return e._scene.actionManager.unregisterAction(t.action)}),delete this.actions,this.movableObject.animations=this.movableObject.animations.filter(function(t){return-1===e.animations.indexOf(t)}),delete this.animations},t}();e.default=s},37:function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=function(l){function t(t,e,n,i,o,r,a,s){var c=l.call(this,t,function(){r()&&(a(),c.animation.setKeys(n()),i([[c.animation],0,o,!1,1,function(){s()}]))})||this;return c.animation=e,c}return o(t,l),Object.defineProperty(t.prototype,"animation",{get:function(){return this._animation},set:function(t){this._animation=t},enumerable:!0,configurable:!0}),t}(r(n(38)).default);e.default=a},38:function(t,e,n){"use strict";var i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var o=i(n(0)),r=function(){function t(t,e){this._action=new o.ExecuteCodeAction(t,e)}return Object.defineProperty(t.prototype,"action",{get:function(){return this._action},enumerable:!0,configurable:!0}),t}();e.default=r},39:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.normalizeNewPositionFromRotationZ=function(t,e){void 0===e&&(e=1);var n=Math.sin(t);1===Math.abs(n)&&(n=n<0?n-e:n+e);var i=Math.cos(t);return 1===Math.abs(i)&&(i=i<0?i-e:i+e),{newZ:i,newX:n}}},40:function(t,e,n){"use strict";var i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var r=i(n(0)),o=function(){function o(t,e,n,i){this.maxFrame=t,this.scene=n,this.animatableModel=e,this.rotation=o.createAnimation("rotation-anim-player-"+i,"rotation"),this.position=o.createAnimation("position-anim-player-"+i,"position")}return o.createAnimation=function(t,e,n){return void 0===n&&(n=r.Animation.ANIMATIONTYPE_VECTOR3),new r.Animation(t,e,60,n)},o.prototype.startPositionAnimation=function(t){this.position.setKeys([{frame:0,value:this.animatableModel.position},{frame:this.maxFrame,value:t}]),this.scene.beginDirectAnimation(this.animatableModel,[this.position],0,this.maxFrame,!1,1)},o.prototype.startRotationAnimation=function(t){this.rotation.setKeys([{frame:0,value:this.animatableModel.rotation},{frame:this.maxFrame,value:t}]),this.scene.beginDirectAnimation(this.animatableModel,[this.rotation],0,this.maxFrame,!1,1)},o}();e.default=o},41:function(t,e,n){"use strict";var i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var o=i(n(42)),r=function(){function t(t){this.ui=o.AdvancedDynamicTexture.CreateFullscreenUI("UI"),this.rectWrapper=new o.Rectangle,this.rectWrapper.adaptWidthToChildren=!0,this.rectWrapper.adaptHeightToChildren=!0,this.rectWrapper.width="350px",this.rectWrapper.height="60px",this.rectWrapper.cornerRadius=20,this.rectWrapper.color="Orange",this.rectWrapper.thickness=4,this.rectWrapper.background="green",this.ui.addControl(this.rectWrapper),this.label=new o.TextBlock,this.label.text=t.text,this.rectWrapper.addControl(this.label),this.rectWrapper.linkWithMesh(t.model),this.rectWrapper.linkOffsetY=-75}return t.prototype.dispose=function(){this.ui.dispose(),this.rectWrapper.dispose(),this.label.dispose()},t}();e.default=r},43:function(t,e,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=o(n(15)),a=function(){function t(t,e){this.players=[],this.players=t,this._scene=e}return t.prototype.getPlayers=function(){return this.players},t.prototype.addPlayer=function(t){this.players.push(new r.default(i({},t,{animatable:!0,withGui:!0}),this._scene))},t.prototype.removePlayer=function(e){var t=this.players.filter(function(t){return t.id===e.id})[0];this.players.splice(this.players.indexOf(t),1),t.dispose()},t.prototype.changePlayerRotation=function(e){this.players.filter(function(t){return t.id===e.id})[0].setRotation(e.rotation)},t.prototype.changePlayerPosition=function(e){this.players.filter(function(t){return t.id===e.id})[0].setPosition(e.position)},t.prototype.removeAll=function(){var e=this;this.players.forEach(function(t){return e.removePlayer(t)})},t}();e.default=a},44:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=i(n(45)),r=function(){function t(t){var e=o.default(t.url,{forceNew:!0});this.socket=e,this.playersCtrl=t.playersCtrl,e.on("field",t.events.onField),e.on("create-player-success",t.events.onCreatePlayerSuccess),this.initEventsHandling()}return t.prototype.initEventsHandling=function(){var e=this;this.socket.on("connect",function(){return console.log("WS: Accept a connection.")}),this.socket.on("player-joined",function(t){console.log("player-joined: ",t),e.playersCtrl.addPlayer(t)}),this.socket.on("player-leaved",function(t){console.log("player-leaved: ",t),e.playersCtrl.removePlayer({id:t})}),this.socket.on("player-changed-rotation",function(t){console.log("player-changed-rotation",t),e.playersCtrl.changePlayerRotation(t)}),this.socket.on("player-changed-position",function(t){console.log("player-changed-position",t),e.playersCtrl.changePlayerPosition(t)})},t.prototype.changeRotation=function(t){this.socket.emit("change-rotation",t)},t.prototype.changePosition=function(t){this.socket.emit("change-position",t)},t}();e.default=r},68:function(t,e){}});